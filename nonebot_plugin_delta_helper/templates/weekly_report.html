{% extends "base.html" %}

{% block extra_styles %}
.chart-container {
    margin: 16px 0;
}

.chart-bar {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
}

.chart-label {
    width: 80px;
    font-size: 14px;
    color: #666;
}

.chart-value {
    flex: 1;
    background-color: #e5e7eb;
    height: 24px;
    border-radius: 4px;
    overflow: hidden;
    position: relative;
}

.chart-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 8px;
}

.chart-text {
    color: white;
    font-size: 12px;
    font-weight: 500;
}
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div class="card-icon">ğŸ“ˆ</div>
        <div>
            <h2 class="card-title">ä¸‰è§’æ´²å‘¨æŠ¥</h2>
            <p class="card-subtitle">{{ user_name }} - {{ stat_date }}</p>
        </div>
    </div>
    
    <div class="card-content">
        <!-- è´¢åŠ¡ç»Ÿè®¡ -->
        <div style="margin-bottom: 24px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">è´¢åŠ¡ç»Ÿè®¡</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">æ€»å¸¦å‡º</div>
                    <div class="stat-value success">{{ gained_price }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ€»å¸¦å…¥</div>
                    <div class="stat-value danger">{{ consume_price }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å‡€åˆ©æ¶¦</div>
                    <div class="stat-value {% if profit >= 0 %}success{% else %}danger{% endif %}">{{ profit_str }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">èµ„äº§å‡€å¢</div>
                    <div class="stat-value {% if rise_price >= 0 %}success{% else %}danger{% endif %}">{{ rise_price_str }}</div>
                </div>
            </div>
        </div>
        
        <!-- æˆ˜æ–—ç»Ÿè®¡ -->
        <div style="margin-bottom: 24px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">æˆ˜æ–—ç»Ÿè®¡</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">æ€»åœºæ¬¡</div>
                    <div class="stat-value">{{ total_sol_num }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">åœ¨çº¿æ—¶é•¿</div>
                    <div class="stat-value">{{ online_time }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">K/D</div>
                    <div class="stat-value">{{ total_kill }}/{{ total_death }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ’¤ç¦»ç‡</div>
                    <div class="stat-value">{{ evacuation_rate }}%</div>
                </div>
            </div>
        </div>
        
        <!-- ç‰¹æ®Šæˆå°± -->
        {% if million_gained > 0 or million_consumed > 0 %}
        <div style="margin-bottom: 24px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">ç‰¹æ®Šæˆå°±</h3>
            <div class="info-row">
                <span class="info-label">ç™¾ä¸‡æ’¤ç¦»</span>
                <span class="badge badge-success">{{ million_gained }}æ¬¡</span>
            </div>
            <div class="info-row">
                <span class="info-label">ç™¾ä¸‡æˆ˜æŸ</span>
                <span class="badge badge-danger">{{ million_consumed }}æ¬¡</span>
            </div>
        </div>
        {% endif %}
        
        <!-- å¹²å‘˜ä½¿ç”¨ç»Ÿè®¡ -->
        {% if armed_forces %}
        <div style="margin-bottom: 24px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">å¹²å‘˜ä½¿ç”¨TOP3</h3>
            <div class="chart-container">
                {% for force in armed_forces[:3] %}
                <div class="chart-bar">
                    <div class="chart-label">{{ force.name }}</div>
                    <div class="chart-value">
                        <div class="chart-fill" style="width: {{ force.percentage }}%;">
                            <span class="chart-text">{{ force.count }}æ¬¡</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- åœ°å›¾æ¸¸ç©ç»Ÿè®¡ -->
        {% if maps %}
        <div>
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #333;">åœ°å›¾æ¸¸ç©TOP3</h3>
            <div class="chart-container">
                {% for map in maps[:3] %}
                <div class="chart-bar">
                    <div class="chart-label" style="width: 120px;">{{ map.name }}</div>
                    <div class="chart-value">
                        <div class="chart-fill" style="width: {{ map.percentage }}%;">
                            <span class="chart-text">{{ map.count }}æ¬¡</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    
    {% if friend_rank %}
    <div class="footer">
        <p>å¥½å‹æ’è¡Œæ¦œï¼šç¬¬{{ friend_rank }}å</p>
    </div>
    {% endif %}
</div>
{% endblock %}